"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=void 0;var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),_asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator")),_isomorphicUnfetch=_interopRequireDefault(require("isomorphic-unfetch")),_index=require("./index"),_validation=require("../validation"),_checkConditionalLogic=_interopRequireDefault(require("./checkConditionalLogic"));function _createForOfIteratorHelper(a,b){var c;if("undefined"==typeof Symbol||null==a[Symbol.iterator]){if(Array.isArray(a)||(c=_unsupportedIterableToArray(a))||b&&a&&"number"==typeof a.length){c&&(a=c);var d=0,e=function(){};return{s:e,n:function n(){return d>=a.length?{done:!0}:{done:!1,value:a[d++]}},e:function e(a){throw a},f:e}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var f,g=!0,h=!1;return{s:function s(){c=a[Symbol.iterator]()},n:function n(){var a=c.next();return g=a.done,a},e:function e(a){h=!0,f=a},f:function f(){try{g||null==c["return"]||c["return"]()}finally{if(h)throw f}}}}function _unsupportedIterableToArray(a,b){if(a){if("string"==typeof a)return _arrayLikeToArray(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);return"Object"===c&&a.constructor&&(c=a.constructor.name),"Map"===c||"Set"===c?Array.from(a):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?_arrayLikeToArray(a,b):void 0}}function _arrayLikeToArray(a,b){(null==b||b>a.length)&&(b=a.length);for(var c=0,d=Array(b);c<b;c++)d[c]=a[c];return d}function fetchForm(){return _fetchForm.apply(this,arguments)}function _fetchForm(){return _fetchForm=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function a(b){var c,d,e,f,g,h,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H;return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return c=b.initialPage,d=b.fetchOptions,e=b.setFormData,f=b.setFormValues,g=b.setActivePage,h=b.setConditionFields,j=b.setConditionalIds,k=b.setPages,l=b.setIsMultiPart,m=b.populatedFields,n=b.populatedEntry,o=b.getParams,p=b.backendUrl,q=b.formID,r=!1,s=o?Object.keys(o).map(function(a){return"".concat(a,"=").concat(o[a])}).join("&"):"",t="".concat(p,"/").concat(q).concat(s?"?".concat(s):""),a.next=6,(0,_isomorphicUnfetch["default"])(t,d).then(function(a){return a.json()}).then(function(a){return a})["catch"](function(){return!1});case 6:if(u=a.sent,u){v={},w=[],x=[],y=[],z=_createForOfIteratorHelper(u.fields);try{for(z.s();!(A=z.n()).done;){if(B=A.value,C=void 0,"page"===B.type&&y.push(B.id),C=(0,_index.getFieldPrepopulatedValue)(B,m,n),"fileupload"===B.type&&(r=!0),B.conditionalLogic){for(D={id:B.id,conditionalLogic:B.conditionalLogic},E=B.conditionalLogic.rules.map(function(a){return a.fieldId}),F=0;F<E.length;F++)G=parseInt(E[F]),-1===x.indexOf(G)&&x.push(G);w.push(D)}v[B.id]={valid:(0,_validation.validateField)(C,B),value:C,label:B.label,pageNumber:B.pageNumber,cssClass:B.cssClass,isRequired:B.isRequired,type:B.type,inputName:B.inputName}}}catch(a){z.e(a)}finally{z.f()}for(H=0;H<w.length;H++)v[w[H].id].hideField=(0,_checkConditionalLogic["default"])(w[H].conditionalLogic,v);e(u),f(v),g(c||!!u.pagination&&1),h(w),j(x),r&&l(r),!y.length||k(y)}case 8:case"end":return a.stop();}},a)})),_fetchForm.apply(this,arguments)}var _default=fetchForm;exports["default"]=_default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9IZWxwZXJzL2Zvcm0vZmV0Y2hGb3JtLmpzIl0sIm5hbWVzIjpbImZldGNoRm9ybSIsImluaXRpYWxQYWdlIiwiZmV0Y2hPcHRpb25zIiwic2V0Rm9ybURhdGEiLCJzZXRGb3JtVmFsdWVzIiwic2V0QWN0aXZlUGFnZSIsInNldENvbmRpdGlvbkZpZWxkcyIsInNldENvbmRpdGlvbmFsSWRzIiwic2V0UGFnZXMiLCJzZXRJc011bHRpUGFydCIsInBvcHVsYXRlZEZpZWxkcyIsInBvcHVsYXRlZEVudHJ5IiwiZ2V0UGFyYW1zIiwiYmFja2VuZFVybCIsImZvcm1JRCIsImlzTXVsdGlwYXJ0IiwicXVlcnlTdHJpbmciLCJPYmplY3QiLCJrZXlzIiwibWFwIiwia2V5Iiwiam9pbiIsInJlcXVlc3RVcmwiLCJ0aGVuIiwicmVzcCIsImpzb24iLCJyZXNwb25zZSIsImZvcm0iLCJmb3JtVmFsdWVzIiwiY29uZGl0aW9uRmllbGRzIiwiY29uZGl0aW9uYWxJZHMiLCJwYWdlcyIsImZpZWxkcyIsImZpZWxkIiwidmFsdWUiLCJ0eXBlIiwicHVzaCIsImlkIiwiY29uZGl0aW9uYWxMb2dpYyIsInRtcEZpZWxkIiwiaWRzIiwicnVsZXMiLCJpdGVtIiwiZmllbGRJZCIsImkiLCJsZW5ndGgiLCJwYXJzZUludCIsImluZGV4T2YiLCJ2YWxpZCIsImxhYmVsIiwicGFnZU51bWJlciIsImNzc0NsYXNzIiwiaXNSZXF1aXJlZCIsImlucHV0TmFtZSIsImhpZGVGaWVsZCIsInBhZ2luYXRpb24iXSwibWFwcGluZ3MiOiJrdERBS2VBLENBQUFBLFMsa0pBQWYsMEtBQ0VDLENBQUFBLENBREYsR0FDRUEsV0FERixDQUVFQyxDQUZGLEdBRUVBLFlBRkYsQ0FHRUMsQ0FIRixHQUdFQSxXQUhGLENBSUVDLENBSkYsR0FJRUEsYUFKRixDQUtFQyxDQUxGLEdBS0VBLGFBTEYsQ0FNRUMsQ0FORixHQU1FQSxrQkFORixDQU9FQyxDQVBGLEdBT0VBLGlCQVBGLENB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Q29CLFNBUkksQ0FVeEIsQ0E3Q08sK0JBZ0RSLElBQVNULENBQVQsQ0FBYSxDQUFiLENBQWdCQSxDQUFDLENBQUdmLENBQWUsQ0FBQ2dCLE1BQXBDLENBQTRDRCxDQUFDLEVBQTdDLENBQ0VoQixDQUFVLENBQUNDLENBQWUsQ0FBQ2UsQ0FBRCxDQUFmLENBQW1CUCxFQUFwQixDQUFWLENBQWtDaUIsU0FBbEMsQ0FBOEMsc0NBQzVDekIsQ0FBZSxDQUFDZSxDQUFELENBQWYsQ0FBbUJOLGdCQUR5QixDQUU1Q1YsQ0FGNEMsQ0FBOUMsQ0FLRnpCLENBQVcsQ0FBQ3dCLENBQUQsQ0F0REgsQ0F1RFJ2QixDQUFhLENBQUN3QixDQUFELENBdkRMLENBd0RSdkIsQ0FBYSxDQUFDSixDQUFXLElBQUswQixDQUFJLENBQUM0QixVQUFWLEVBQXVCLENBQW5DLENBeERMLENBeURSakQsQ0FBa0IsQ0FBQ3VCLENBQUQsQ0F6RFYsQ0EwRFJ0QixDQUFpQixDQUFDdUIsQ0FBRCxDQTFEVCxDQTRESmYsQ0E1REksRUE0RFNOLENBQWMsQ0FBQ00sQ0FBRCxDQTVEdkIsQ0E4REgsQ0FBQ2dCLENBQUssQ0FBQ2MsTUE5REosRUE4RFlyQyxDQUFRLENBQUN1QixDQUFELENBQzdCLENBL0ZILHVDLGlEQWtHZS9CLFMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgZmV0Y2ggZnJvbSBcImlzb21vcnBoaWMtdW5mZXRjaFwiO1xyXG5pbXBvcnQgeyBnZXRGaWVsZFByZXBvcHVsYXRlZFZhbHVlIH0gZnJvbSBcIi4vaW5kZXhcIjtcclxuaW1wb3J0IHsgdmFsaWRhdGVGaWVsZCB9IGZyb20gXCIuLi92YWxpZGF0aW9uXCI7XHJcbmltcG9ydCBjaGVja0NvbmRpdGlvbmFsTG9naWMgZnJvbSBcIi4vY2hlY2tDb25kaXRpb25hbExvZ2ljXCI7XHJcblxyXG5hc3luYyBmdW5jdGlvbiBmZXRjaEZvcm0oe1xyXG4gIGluaXRpYWxQYWdlLFxyXG4gIGZldGNoT3B0aW9ucyxcclxuICBzZXRGb3JtRGF0YSxcclxuICBzZXRGb3JtVmFsdWVzLFxyXG4gIHNldEFjdGl2ZVBhZ2UsXHJcbiAgc2V0Q29uZGl0aW9uRmllbGRzLFxyXG4gIHNldENvbmRpdGlvbmFsSWRzLFxyXG4gIHNldFBhZ2VzLFxyXG4gIHNldElzTXVsdGlQYXJ0LFxyXG4gIHBvcHVsYXRlZEZpZWxkcyxcclxuICBwb3B1bGF0ZWRFbnRyeSxcclxuICBnZXRQYXJhbXMsXHJcbiAgYmFja2VuZFVybCxcclxuICBmb3JtSUQsXHJcbn0pIHtcclxuICBsZXQgaXNNdWx0aXBhcnQgPSBmYWxzZTtcclxuXHJcbiAgY29uc3QgcXVlcnlTdHJpbmcgPSBnZXRQYXJhbXNcclxuICAgID8gT2JqZWN0LmtleXMoZ2V0UGFyYW1zKVxyXG4gICAgICAgIC5tYXAoa2V5ID0+IGAke2tleX09JHtnZXRQYXJhbXNba2V5XX1gKVxyXG4gICAgICAgIC5qb2luKFwiJlwiKVxyXG4gICAgOiBcIlwiO1xyXG4gIGNvbnN0IHJlcXVlc3RVcmwgPSBgJHtiYWNrZW5kVXJsfS8ke2Zvcm1JRH0ke1xyXG4gICAgcXVlcnlTdHJpbmcgPyBgPyR7cXVlcnlTdHJpbmd9YCA6IFwiXCJcclxuICB9YDtcclxuXHJcbiAgY29uc3QgZm9ybSA9IGF3YWl0IGZldGNoKHJlcXVlc3RVcmwsIGZldGNoT3B0aW9ucylcclxuICAgIC50aGVuKHJlc3AgPT4gcmVzcC5qc29uKCkpXHJcbiAgICAudGhlbihyZXNwb25zZSA9PiByZXNwb25zZSlcclxuICAgIC5jYXRjaCgoKSA9PiBmYWxzZSk7XHJcblxyXG4gIGlmIChmb3JtKSB7XHJcbiAgICBjb25zdCBmb3JtVmFsdWVzID0ge307XHJcbiAgICBjb25zdCBjb25kaXRpb25GaWVsZHMgPSBbXTtcclxuICAgIGNvbnN0IGNvbmRpdGlvbmFsSWRzID0gW107XHJcbiAgICBjb25zdCBwYWdlcyA9IFtdO1xyXG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXJlc3RyaWN0ZWQtc3ludGF4XHJcbiAgICBmb3IgKGNvbnN0IGZpZWxkIG9mIGZvcm0uZmllbGRzKSB7XHJcbiAgICAgIGxldCB2YWx1ZTtcclxuXHJcbiAgICAgIGlmIChmaWVsZC50eXBlID09PSBcInBhZ2VcIikge1xyXG4gICAgICAgIHBhZ2VzLnB1c2goZmllbGQuaWQpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICB2YWx1ZSA9IGdldEZpZWxkUHJlcG9wdWxhdGVkVmFsdWUoZmllbGQsIHBvcHVsYXRlZEZpZWxkcywgcG9wdWxhdGVkRW50cnkpO1xyXG5cclxuICAgICAgaWYgKGZpZWxkLnR5cGUgPT09IFwiZmlsZXVwbG9hZFwiKSB7XHJcbiAgICAgICAgaXNNdWx0aXBhcnQgPSB0cnVlO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBncmFiIGFsbCBjb25kaXRpb25hbCBsb2dpYyBmaWVsZHNcclxuICAgICAgaWYgKGZpZWxkLmNvbmRpdGlvbmFsTG9naWMpIHtcclxuICAgICAgICBjb25zdCB0bXBGaWVsZCA9IHtcclxuICAgICAgICAgIGlkOiBmaWVsZC5pZCxcclxuICAgICAgICAgIGNvbmRpdGlvbmFsTG9naWM6IGZpZWxkLmNvbmRpdGlvbmFsTG9naWMsXHJcbiAgICAgICAgfTtcclxuICAgICAgICBjb25zdCBpZHMgPSBmaWVsZC5jb25kaXRpb25hbExvZ2ljLnJ1bGVzLm1hcChpdGVtID0+IGl0ZW0uZmllbGRJZCk7XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBpZHMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgIGNvbnN0IGlkID0gcGFyc2VJbnQoaWRzW2ldKTtcclxuICAgICAgICAgIGlmIChjb25kaXRpb25hbElkcy5pbmRleE9mKGlkKSA9PT0gLTEpIHtcclxuICAgICAgICAgICAgY29uZGl0aW9uYWxJZHMucHVzaChpZCk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbmRpdGlvbkZpZWxkcy5wdXNoKHRtcEZpZWxkKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgZm9ybVZhbHVlc1tmaWVsZC5pZF0gPSB7XHJcbiAgICAgICAgdmFsaWQ6IHZhbGlkYXRlRmllbGQodmFsdWUsIGZpZWxkKSxcclxuICAgICAgICB2YWx1ZSxcclxuICAgICAgICBsYWJlbDogZmllbGQubGFiZWwsXHJcbiAgICAgICAgcGFnZU51bWJlcjogZmllbGQucGFnZU51bWJlcixcclxuICAgICAgICBjc3NDbGFzczogZmllbGQuY3NzQ2xhc3MsXHJcbiAgICAgICAgaXNSZXF1aXJlZDogZmllbGQuaXNSZXF1aXJlZCxcclxuICAgICAgICB0eXBlOiBmaWVsZC50eXBlLFxyXG4gICAgICAgIGlucHV0TmFtZTogZmllbGQuaW5wdXROYW1lLFxyXG4gICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIGNoZWNrIGNvbmRpdGlvbiBsb2dpY1xyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb25kaXRpb25GaWVsZHMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgZm9ybVZhbHVlc1tjb25kaXRpb25GaWVsZHNbaV0uaWRdLmhpZGVGaWVsZCA9IGNoZWNrQ29uZGl0aW9uYWxMb2dpYyhcclxuICAgICAgICBjb25kaXRpb25GaWVsZHNbaV0uY29uZGl0aW9uYWxMb2dpYyxcclxuICAgICAgICBmb3JtVmFsdWVzXHJcbiAgICAgICk7XHJcbiAgICB9XHJcbiAgICBzZXRGb3JtRGF0YShmb3JtKTtcclxuICAgIHNldEZvcm1WYWx1ZXMoZm9ybVZhbHVlcyk7XHJcbiAgICBzZXRBY3RpdmVQYWdlKGluaXRpYWxQYWdlIHx8IChmb3JtLnBhZ2luYXRpb24gPyAxIDogZmFsc2UpKTtcclxuICAgIHNldENvbmRpdGlvbkZpZWxkcyhjb25kaXRpb25GaWVsZHMpO1xyXG4gICAgc2V0Q29uZGl0aW9uYWxJZHMoY29uZGl0aW9uYWxJZHMpO1xyXG5cclxuICAgIGlmIChpc011bHRpcGFydCkgc2V0SXNNdWx0aVBhcnQoaXNNdWx0aXBhcnQpO1xyXG5cclxuICAgIGlmICghIXBhZ2VzLmxlbmd0aCkgc2V0UGFnZXMocGFnZXMpO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgZmV0Y2hGb3JtO1xyXG4iXX0=